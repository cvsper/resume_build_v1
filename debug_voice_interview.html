<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Interview Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 5px; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>Voice Interview Debug Page</h1>
    
    <div class="debug-section">
        <h2>1. API Test</h2>
        <button onclick="testStartAPI()">Test Start Interview API</button>
        <button onclick="testSubmitAPI()">Test Submit Answer API</button>
        <div id="api-results"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. Browser Features Test</h2>
        <button onclick="testMicrophone()">Test Microphone Access</button>
        <button onclick="testSpeechRecognition()">Test Speech Recognition</button>
        <button onclick="testTextToSpeech()">Test Text-to-Speech</button>
        <div id="browser-results"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. Console Logs</h2>
        <div id="console-logs"></div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const consoleDiv = document.getElementById('console-logs');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleDiv.innerHTML += '<div class="success">[LOG] ' + args.join(' ') + '</div>';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            consoleDiv.innerHTML += '<div class="error">[ERROR] ' + args.join(' ') + '</div>';
        };
        
        // Test functions
        async function testStartAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML += '<div>Testing start interview API...</div>';
            
            try {
                const response = await fetch('/api/start-voice-interview', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        job_title: 'Software Engineer',
                        personality: 'friendly'
                    })
                });
                
                const data = await response.json();
                resultsDiv.innerHTML += '<div class="success">API Response: ' + JSON.stringify(data) + '</div>';
            } catch (error) {
                resultsDiv.innerHTML += '<div class="error">API Error: ' + error.message + '</div>';
            }
        }
        
        async function testSubmitAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML += '<div>Testing submit answer API...</div>';
            
            try {
                const response = await fetch('/api/submit-voice-answer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        session_id: 1,
                        question_number: 1,
                        answer_text: 'Test answer'
                    })
                });
                
                const data = await response.json();
                resultsDiv.innerHTML += '<div class="success">API Response: ' + JSON.stringify(data) + '</div>';
            } catch (error) {
                resultsDiv.innerHTML += '<div class="error">API Error: ' + error.message + '</div>';
            }
        }
        
        async function testMicrophone() {
            const resultsDiv = document.getElementById('browser-results');
            resultsDiv.innerHTML += '<div>Testing microphone access...</div>';
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                resultsDiv.innerHTML += '<div class="success">✅ Microphone access granted</div>';
                stream.getTracks().forEach(track => track.stop());
            } catch (error) {
                resultsDiv.innerHTML += '<div class="error">❌ Microphone error: ' + error.message + '</div>';
            }
        }
        
        function testSpeechRecognition() {
            const resultsDiv = document.getElementById('browser-results');
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                resultsDiv.innerHTML += '<div class="success">✅ Speech Recognition supported</div>';
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.lang = 'en-US';
                
                recognition.onresult = function(event) {
                    resultsDiv.innerHTML += '<div class="success">✅ Speech Recognition working: ' + event.results[0][0].transcript + '</div>';
                };
                
                recognition.onerror = function(event) {
                    resultsDiv.innerHTML += '<div class="error">❌ Speech Recognition error: ' + event.error + '</div>';
                };
                
                recognition.start();
                setTimeout(() => recognition.stop(), 3000);
            } else {
                resultsDiv.innerHTML += '<div class="error">❌ Speech Recognition not supported</div>';
            }
        }
        
        function testTextToSpeech() {
            const resultsDiv = document.getElementById('browser-results');
            
            if ('speechSynthesis' in window) {
                resultsDiv.innerHTML += '<div class="success">✅ Text-to-Speech supported</div>';
                
                const utterance = new SpeechSynthesisUtterance('This is a test of text to speech');
                utterance.onend = function() {
                    resultsDiv.innerHTML += '<div class="success">✅ Text-to-Speech working</div>';
                };
                
                speechSynthesis.speak(utterance);
            } else {
                resultsDiv.innerHTML += '<div class="error">❌ Text-to-Speech not supported</div>';
            }
        }
        
        console.log('Debug page loaded');
    </script>
</body>
</html>