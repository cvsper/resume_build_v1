<!DOCTYPE html>
<html>
<head>
    <title>Test Subscription Button</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>ðŸ§ª Test Subscription Button</h1>
        
        <div class="alert alert-info">
            <strong>Instructions:</strong>
            <ol>
                <li>Open your browser console (F12 â†’ Console)</li>
                <li>Click the subscription button below</li>
                <li>Watch for console messages and behavior</li>
            </ol>
        </div>
        
        <div class="card">
            <div class="card-body">
                <h5>Subscription Button Test</h5>
                <a class="btn btn-primary" href="javascript:void(0)" onclick="openCustomerPortal()" title="Manage your subscription, payment methods, and billing">
                    <i class="bi bi-credit-card"></i> Subscription
                </a>
            </div>
        </div>
        
        <div class="mt-4">
            <h5>Debug Information</h5>
            <div id="debug-info"></div>
        </div>
    </div>

    <script>
        // Test the exact same function as in dashboard
        function openCustomerPortal() {
            console.log('openCustomerPortal() called');
            
            if (confirm('You will be redirected to Stripe Customer Portal where you can manage your subscription, update payment methods, and view billing history. Continue?')) {
                console.log('User confirmed, creating form...');
                
                // Show loading state
                const button = document.querySelector('a[onclick*="openCustomerPortal"]');
                const originalText = button?.innerHTML;
                if (button) {
                    button.innerHTML = '<i class="bi bi-hourglass-split"></i> Loading...';
                    button.style.pointerEvents = 'none';
                }
                
                try {
                    // Create form to open customer portal
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/create-customer-portal';
                    
                    console.log('Form created, submitting...');
                    console.log('Form action:', form.action);
                    console.log('Form method:', form.method);
                    
                    document.body.appendChild(form);
                    
                    // For testing, let's not actually submit but show what would happen
                    alert('Form would submit to: ' + form.action + ' with method: ' + form.method);
                    
                    // Restore button
                    if (button && originalText) {
                        button.innerHTML = originalText;
                        button.style.pointerEvents = 'auto';
                    }
                    
                    // Remove test form
                    document.body.removeChild(form);
                    
                } catch (error) {
                    console.error('Error creating form:', error);
                    if (button && originalText) {
                        button.innerHTML = originalText;
                        button.style.pointerEvents = 'auto';
                    }
                    alert('Error opening subscription portal. Please try again.');
                }
            } else {
                console.log('User cancelled');
            }
        }

        // Log when script loads
        console.log('Test script loaded');
        
        // Test function availability
        console.log('openCustomerPortal function available:', typeof openCustomerPortal);
        
        // Show debug info
        document.getElementById('debug-info').innerHTML = `
            <p><strong>Function available:</strong> ${typeof openCustomerPortal}</p>
            <p><strong>Button found:</strong> ${document.querySelector('a[onclick*="openCustomerPortal"]') ? 'Yes' : 'No'}</p>
            <p><strong>Current URL:</strong> ${window.location.href}</p>
        `;
    </script>
</body>
</html>
