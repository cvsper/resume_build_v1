{% extends "base_dashboard.html" %}

{% block title %}Interview Q&A - Practice & Prepare | Professional Interview Preparation{% endblock %}

{% block meta_description %}Prepare for job interviews with our comprehensive Q&A database. Practice common interview questions, get expert answers, and boost your confidence for any interview.{% endblock %}

{% block meta_keywords %}interview questions, interview preparation, job interview practice, interview answers, interview tips, career preparation, job interview help{% endblock %}

{% block head %}
<!-- Interview Q&A Page Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Interview Q&A - Professional Interview Preparation",
  "description": "Comprehensive interview preparation with practice questions, expert answers, and tips for job interview success",
  "url": "{{ request.url }}",
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ url_for('index', _external=True) }}"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Dashboard",
        "item": "{{ url_for('dashboard', _external=True) }}"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "Interview Q&A",
        "item": "{{ request.url }}"
      }
    ]
  },
  "mainEntity": {
    "@type": "EducationalResource",
    "@id": "interview-preparation-resource",
    "name": "Interview Preparation Resource",
    "description": "Comprehensive collection of interview questions and preparation materials"
  }
}
</script>

<!-- FAQ Schema for Interview Questions -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "How should I prepare for a job interview?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Research the company, practice common questions, prepare your own questions, dress appropriately, and arrive early. Use our Q&A database to practice responses to typical interview scenarios."
      }
    },
    {
      "@type": "Question",
      "name": "What are the most common interview questions?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Common questions include 'Tell me about yourself', 'Why do you want this job?', 'What are your strengths and weaknesses?', and behavioral questions about past experiences."
      }
    }
  ]
}
</script>
{% endblock %}

{% block styles %}
<style>
    body {
        background: #FAFBFC;
    }
    
    /* Page Header */
    .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .page-title h1 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--gray-900);
        margin: 0;
        letter-spacing: -0.025em;
    }
    
    /* Generate Form */
    .generate-form {
        background: white;
        border-radius: 12px;
        border: 1px solid var(--gray-100);
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--gray-900);
        font-size: 0.95rem;
    }
    
    .form-control {
        width: 100%;
        padding: 0.875rem 1rem;
        font-size: 0.95rem;
        border: 1px solid var(--gray-200);
        border-radius: 8px;
        background: white;
        transition: all 0.2s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .form-text {
        font-size: 0.875rem;
        color: var(--gray-500);
        margin-top: 0.5rem;
    }
    
    .btn-generate {
        background: var(--primary-blue);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 0.95rem;
        font-weight: 600;
        padding: 0.875rem 1.5rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-generate:hover {
        background: var(--primary-blue-dark);
        transform: translateY(-1px);
    }
    
    .btn-generate:disabled {
        background: var(--gray-300);
        cursor: not-allowed;
        transform: none;
    }
    
    /* Section Title */
    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        letter-spacing: -0.025em;
    }
    
    .section-title i {
        color: var(--primary-blue);
        font-size: 1.25rem;
    }
    
    /* Q&A Grid */
    .qa-grid {
        display: grid;
        gap: 1.5rem;
    }
    
    .qa-card {
        background: white;
        border-radius: 12px;
        border: 1px solid var(--gray-100);
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .qa-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        border-color: var(--gray-200);
    }
    
    .qa-card-header {
        padding: 1.5rem 1.5rem 1rem;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        border-bottom: 1px solid var(--gray-50);
    }
    
    .qa-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--gray-900);
        margin: 0;
        letter-spacing: -0.025em;
    }
    
    .qa-date {
        font-size: 0.875rem;
        color: var(--gray-500);
        background: var(--gray-50);
        padding: 0.25rem 0.75rem;
        border-radius: 6px;
    }
    
    .qa-preview {
        padding: 0 1.5rem 1rem;
        color: var(--gray-600);
        line-height: 1.6;
        font-size: 0.95rem;
    }
    
    .qa-actions {
        padding: 1rem 1.5rem 1.5rem;
        display: flex;
        gap: 0.75rem;
    }
    
    .btn-action {
        padding: 0.625rem 1rem;
        border: none;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .btn-expand {
        background: var(--primary-blue);
        color: white;
        flex: 1;
    }
    
    .btn-expand:hover {
        background: var(--primary-blue-dark);
        transform: translateY(-1px);
    }
    
    .btn-delete {
        background: var(--gray-100);
        color: var(--gray-600);
        min-width: 80px;
    }
    
    .btn-delete:hover {
        background: var(--red-light);
        color: var(--red-500);
    }
    
    /* Full Content Display */
    .qa-full-content {
        display: none;
        padding: 1.5rem;
        background: var(--gray-50);
        border-top: 1px solid var(--gray-100);
    }
    
    .qa-full-content.show {
        display: block;
        animation: fadeIn 0.3s ease;
    }
    
    .qa-full-content h4 {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 1rem;
    }
    
    .qa-full-content pre {
        white-space: pre-wrap;
        word-wrap: break-word;
        font-family: inherit;
        font-size: 0.95rem;
        line-height: 1.6;
        color: var(--gray-700);
        margin: 0;
    }
    
    /* Empty State */
    .empty-state {
        padding: 4rem 2rem;
        text-align: center;
        background: white;
        border-radius: 16px;
        border: 1px solid var(--gray-100);
        max-width: 600px;
        margin: 0 auto;
    }
    
    .empty-icon {
        font-size: 4rem;
        color: var(--gray-300);
        margin-bottom: 1.5rem;
    }
    
    .empty-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.75rem;
        letter-spacing: -0.025em;
    }
    
    .empty-subtitle {
        font-size: 1rem;
        color: var(--gray-600);
        line-height: 1.6;
        max-width: 480px;
        margin: 0 auto;
    }
    
    /* Autocomplete Dropdown */
    .autocomplete-dropdown {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--gray-200) !important;
    }
    
    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* Mobile Responsiveness */
    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .generate-form {
            padding: 1.5rem;
        }
        
        .qa-card-header {
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-start;
        }
        
        .qa-actions {
            flex-direction: column;
        }
        
        .btn-expand {
            justify-content: center;
        }
        
        .empty-state {
            padding: 3rem 1.5rem;
        }
        
        .empty-icon {
            font-size: 3rem;
        }
        
        .empty-title {
            font-size: 1.25rem;
        }
    }
    
    @media (max-width: 480px) {
        .generate-form {
            padding: 1.25rem;
        }
        
        .qa-card-header {
            padding: 1.25rem 1.25rem 0.75rem;
        }
        
        .qa-preview {
            padding: 0 1.25rem 0.75rem;
        }
        
        .qa-actions {
            padding: 0.75rem 1.25rem 1.25rem;
        }
        
        .qa-full-content {
            padding: 1.25rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div id="fade-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="bi bi-list"></i>
    </button>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="closeMobileMenu()"></div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <img src="{{ url_for('static', filename='uploads/profile_pics/' ~ current_user.profile_pic) }}" 
                 alt="Profile Picture" 
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCA4MCA4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiNEMUQ1REIiIHJ4PSI0MCIvPjxwYXRoIGZpbGw9IiM5Q0EzQUYiIGQ9Ik00MCAyNGM0LjQgMCA4IDMuNiA4IDhzLTMuNiA4LTggOC04LTMuNi04LTggMy42LTggOC04Wm0wIDM2Yy04LjggMC0xNi0zLjYtMTYtOHYtMmMwLTQuNCA3LjItOCAxNi04czE2IDMuNiAxNiA4djJjMCA0LjQtNy4yIDgtMTYgOFoiLz48L3N2Zz4='">
            <h4>{{ current_user.name or current_user.email }}</h4>
            <div class="user-role">Resume Builder</div>
        </div>
        <nav class="nav flex-column">
            <a class="nav-link {% if active_page == 'dashboard' %}active{% endif %}" href="{{ url_for('dashboard') }}">
                <i class="bi bi-house"></i>
                Dashboard
            </a>
            <a class="nav-link {% if active_page == 'resumes' %}active{% endif %}" href="{{ url_for('resumes') }}">
                <i class="bi bi-file-earmark-person"></i>
                Resumes
            </a>
            <a class="nav-link {% if active_page == 'cover_letters' %}active{% endif %}" href="{{ url_for('cover_letters') }}">
                <i class="bi bi-envelope-paper"></i>
                Cover Letters
            </a>
            <a class="nav-link {% if active_page == 'interview_qa' %}active{% endif %}" href="{{ url_for('interview_qa') }}">
                <i class="bi bi-question-circle"></i>
                Interview Q&A
            </a>
            <a class="nav-link {% if active_page == 'jobs' %}active{% endif %}" href="{{ url_for('jobs') }}">
                <i class="bi bi-briefcase"></i>
                Jobs
            </a>
            <a class="nav-link {% if active_page == 'my_account' %}active{% endif %}" href="{{ url_for('my_account') }}">
                <i class="bi bi-person"></i>
                My Account
            </a>
            <a class="nav-link" href="{{ url_for('pricing') }}" title="View and manage subscription plans">
                <i class="bi bi-credit-card"></i>
                Subscription
            </a>
            <a class="nav-link text-danger" href="{{ url_for('logout') }}">
                <i class="bi bi-box-arrow-right"></i>
                Logout
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <header class="page-header">
            <div class="page-title">
                <h1>Interview Q&A</h1>
            </div>
        </header>

        <!-- Generate Q&A Form -->
        <div class="generate-form">
            <form method="POST" action="{{ url_for('interview_qa') }}">
                <div class="form-group">
                    <label for="job-title-input" class="form-label">
                        <i class="bi bi-briefcase"></i> Job Title
                    </label>
                    <input type="text" 
                           id="job-title-input"
                           name="job_title" 
                           class="form-control" 
                           placeholder="e.g., Software Engineer, Product Manager, Data Scientist..." 
                           required>
                    <div class="form-text">
                        Enter a specific job title to generate relevant interview questions and sample answers
                    </div>
                </div>
                <button type="submit" class="btn-generate">
                    <i class="bi bi-plus-circle"></i>Generate Q&A
                </button>
            </form>
        </div>

        {% if interview_qa_list|length > 0 %}
        <!-- Interview Q&A Collection -->
        <section class="interview-qa-collection">
            <h2 class="section-title">
                <i class="bi bi-collection"></i>Your Interview Preparations
            </h2>
            
            <div class="qa-grid">
                {% for qa in interview_qa_list %}
                <article class="qa-card" data-qa-id="{{ loop.index }}">
                    <div class="qa-card-header">
                        <h3 class="qa-title">{{ qa.job_title }}</h3>
                        {% if qa.created_at %}
                        <span class="qa-date">
                            {{ qa.created_at.strftime('%b %d, %Y') }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <div class="qa-preview">
                        {{ qa.qa|truncate(150, True, '...') }}
                    </div>
                    
                    <div class="qa-actions">
                        <button class="btn-action btn-expand" onclick="toggleQAContent({{ loop.index }})">
                            <i class="bi bi-eye"></i>View Full Content
                        </button>
                        <button class="btn-action btn-delete" onclick="deleteQA({{ loop.index }}, '{{ qa.job_title }}')">
                            <i class="bi bi-trash"></i>Delete
                        </button>
                    </div>
                    
                    <div class="qa-full-content" id="qa-content-{{ loop.index }}">
                        <h4>Complete Q&A for {{ qa.job_title }}</h4>
                        <pre>{{ qa.qa }}</pre>
                    </div>
                </article>
                {% endfor %}
            </div>
        </section>
        {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-icon">
                <i class="bi bi-question-circle"></i>
            </div>
            <h2 class="empty-title">Ready to ace your next interview?</h2>
            <p class="empty-subtitle">
                Generate personalized interview questions and answers tailored to specific job roles. 
                Practice your responses and boost your confidence for any interview scenario.
            </p>
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Mobile menu functionality
    function toggleMobileMenu() {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
    }
    function closeMobileMenu() {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
    }
    // Close mobile menu when clicking on nav links
    document.querySelectorAll('.sidebar .nav-link').forEach(link => {
        link.addEventListener('click', closeMobileMenu);
    });

    // Clean, functional JavaScript for better UX
    document.addEventListener('DOMContentLoaded', function() {
        // Focus job title input for better UX
        const jobTitleInput = document.querySelector('input[name="job_title"]');
        if (jobTitleInput) {
            jobTitleInput.focus();
        }
        
        // Form validation with user-friendly feedback
        const form = document.querySelector('form[method="POST"]');
        if (form) {
            form.addEventListener('submit', function(e) {
                const input = this.querySelector('input[name="job_title"]');
                const value = input.value.trim();
                
                if (!value) {
                    e.preventDefault();
                    showErrorMessage(input, 'Please enter a job title to generate interview questions.');
                    return false;
                }
                
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Generating Q&A...';
                    
                    // Add visual feedback
                    submitBtn.style.opacity = '0.7';
                    submitBtn.style.cursor = 'not-allowed';
                }
            });
        }
        
        // Enhanced autocomplete for job titles
        if (jobTitleInput) {
            const commonJobs = [
                'Software Engineer', 'Product Manager', 'Data Scientist', 'Marketing Manager',
                'Sales Representative', 'Business Analyst', 'UX/UI Designer', 'Project Manager',
                'Customer Service Representative', 'Accountant', 'HR Manager', 'DevOps Engineer',
                'Frontend Developer', 'Backend Developer', 'Full Stack Developer', 'Data Analyst',
                'Digital Marketing Specialist', 'Content Writer', 'Graphic Designer', 'Operations Manager'
            ];
            
            // Create autocomplete dropdown
            const dropdown = document.createElement('div');
            dropdown.className = 'autocomplete-dropdown';
            dropdown.style.cssText = `
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                border: 1px solid #ddd;
                border-top: none;
                border-radius: 0 0 8px 8px;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                display: none;
            `;
            
            jobTitleInput.parentNode.style.position = 'relative';
            jobTitleInput.parentNode.appendChild(dropdown);
            
            jobTitleInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                dropdown.innerHTML = '';
                
                if (value.length > 1) {
                    const matches = commonJobs.filter(job => 
                        job.toLowerCase().includes(value)
                    ).slice(0, 5);
                    
                    if (matches.length > 0) {
                        matches.forEach(job => {
                            const item = document.createElement('div');
                            item.textContent = job;
                            item.style.cssText = `
                                padding: 10px;
                                cursor: pointer;
                                border-bottom: 1px solid #eee;
                            `;
                            item.addEventListener('mouseenter', () => item.style.background = '#f0f0f0');
                            item.addEventListener('mouseleave', () => item.style.background = 'white');
                            item.addEventListener('click', () => {
                                jobTitleInput.value = job;
                                dropdown.style.display = 'none';
                            });
                            dropdown.appendChild(item);
                        });
                        dropdown.style.display = 'block';
                    } else {
                        dropdown.style.display = 'none';
                    }
                } else {
                    dropdown.style.display = 'none';
                }
            });
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!jobTitleInput.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.style.display = 'none';
                }
            });
        }
    });

    // Toggle Q&A content visibility
    function toggleQAContent(qaId) {
        const content = document.getElementById(`qa-content-${qaId}`);
        const button = event.target.closest('.btn-expand');
        
        if (content.classList.contains('show')) {
            content.classList.remove('show');
            button.innerHTML = '<i class="bi bi-eye me-1"></i>View Full Content';
        } else {
            // Hide all other open contents
            document.querySelectorAll('.qa-full-content.show').forEach(el => {
                el.classList.remove('show');
            });
            document.querySelectorAll('.btn-expand').forEach(btn => {
                btn.innerHTML = '<i class="bi bi-eye me-1"></i>View Full Content';
            });
            
            // Show this content
            content.classList.add('show');
            button.innerHTML = '<i class="bi bi-eye-slash me-1"></i>Hide Content';
            
            // Scroll to content
            content.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    }

    // Delete Q&A item (client-side only for now)
    function deleteQA(qaId, jobTitle) {
        if (confirm(`Are you sure you want to delete the interview Q&A for "${jobTitle}"?`)) {
            const card = document.querySelector(`[data-qa-id="${qaId}"]`);
            if (card) {
                // Add fade out animation
                card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    card.remove();
                    
                    // Check if this was the last item
                    const remainingCards = document.querySelectorAll('.qa-card');
                    if (remainingCards.length === 0) {
                        // Reload page to show empty state
                        window.location.reload();
                    }
                }, 300);
                
                // Show success message
                showSuccessMessage(`Interview Q&A for "${jobTitle}" has been deleted.`);
            }
        }
    }

    // Show error message
    function showErrorMessage(input, message) {
        // Remove existing error
        const existingError = input.parentNode.querySelector('.error-message');
        if (existingError) {
            existingError.remove();
        }
        
        // Add error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.style.cssText = `
            color: #d32f2f;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #ffebee;
            border-radius: 4px;
            border-left: 3px solid #d32f2f;
        `;
        errorDiv.textContent = message;
        
        input.parentNode.appendChild(errorDiv);
        input.focus();
        
        // Add error styling to input
        input.style.borderColor = '#d32f2f';
        
        // Remove error after 5 seconds
        setTimeout(() => {
            if (errorDiv.parentNode) {
                errorDiv.remove();
                input.style.borderColor = '';
            }
        }, 5000);
    }

    // Show success message
    function showSuccessMessage(message) {
        const successDiv = document.createElement('div');
        successDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        `;
        successDiv.textContent = message;
        
        // Add slide in animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(successDiv);
        
        // Remove after 3 seconds
        setTimeout(() => {
            successDiv.style.animation = 'slideIn 0.3s ease reverse';
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
                if (style.parentNode) {
                    style.remove();
                }
            }, 300);
        }, 3000);
    }

    // Add smooth scroll behavior for better UX
    document.documentElement.style.scrollBehavior = 'smooth';

    // Subscription button functionality
    function openCustomerPortal() {
        console.log('Subscription button clicked');
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/create-customer-portal';
        form.style.display = 'none';
        document.body.appendChild(form);
        form.submit();
    }
    // Make function globally accessible
    window.openCustomerPortal = openCustomerPortal;
</script>
{% endblock %}
