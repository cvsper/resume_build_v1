<!DOCTYPE html>
<html lang="en">
<head>
    <title>Create Cover Letter - Professional Cover Letter Builder</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #3B82F6;
            --primary-blue-dark: #2563EB;
            --primary-blue-light: #DBEAFE;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            --success-green: #10B981;
            --success-light: #D1FAE5;
            --warning-amber: #F59E0B;
            --warning-light: #FEF3C7;
            --purple-500: #8B5CF6;
            --purple-light: #EDE9FE;
            --red-500: #EF4444;
            --red-light: #FEE2E2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #FAFBFC;
            min-height: 100vh;
        }

        .sidebar {
            min-height: 100vh;
            background: #fff;
            box-shadow: 0 0 30px rgba(0,0,0,0.08);
            padding: 0;
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            z-index: 100;
            border-right: 1px solid var(--gray-200);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            text-align: center;
            border-bottom: 1px solid var(--gray-100);
            background: linear-gradient(135deg, var(--gray-50) 0%, #fff 100%);
        }

        .sidebar-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 1rem;
            border: 4px solid var(--primary-blue);
            object-fit: cover;
        }

        .sidebar-header h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .sidebar-header .user-role {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 400;
        }

        .sidebar nav {
            padding: 1.5rem 0;
        }

        .sidebar .nav-link {
            color: var(--gray-600);
            font-weight: 500;
            font-size: 0.95rem;
            padding: 0.875rem 1.5rem;
            margin: 0.25rem 1rem;
            border-radius: 12px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .sidebar .nav-link i {
            margin-right: 0.75rem;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .sidebar .nav-link:hover {
            background: var(--gray-50);
            color: var(--primary-blue);
            transform: translateX(4px);
        }

        .sidebar .nav-link.active {
            background: var(--primary-blue-light);
            color: var(--primary-blue-dark);
            font-weight: 600;
        }

        .sidebar .nav-link.text-danger {
            color: var(--red-500);
            margin-top: 1rem;
            border-top: 1px solid var(--gray-100);
            padding-top: 1.5rem;
        }

        .sidebar .nav-link.text-danger:hover {
            background: var(--red-light);
            color: var(--red-500);
        }

        .main-content {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        .page-header {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--gray-100);
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            letter-spacing: -0.025em;
        }

        .page-title .icon {
            width: 48px;
            height: 48px;
            background: var(--success-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--success-green);
            font-size: 1.25rem;
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: var(--gray-600);
            margin-bottom: 0;
            font-weight: 400;
        }

        .form-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--gray-100);
            max-width: 800px;
        }

        .form-section {
            margin-bottom: 2.5rem;
        }

        .form-section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.025em;
        }

        .form-section-title i {
            width: 32px;
            height: 32px;
            background: var(--primary-blue-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-size: 0.875rem;
        }

        .completion-badge {
            margin-left: auto;
            color: var(--success-green);
            font-size: 1.25rem;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .completion-badge.show {
            opacity: 1;
            transform: scale(1);
        }

        .form-label {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-label .required {
            color: var(--red-500);
            font-size: 0.875rem;
        }

        .form-control {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 0.875rem 1rem;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background: white;
            font-family: 'Inter', sans-serif;
        }

        .form-control:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: white;
            outline: none;
        }

        .form-control::placeholder {
            color: var(--gray-400);
            font-weight: 400;
        }

        .form-help {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-help i {
            color: var(--primary-blue);
        }

        .input-group-icon {
            position: relative;
        }

        .input-group-icon .form-control {
            padding-left: 3rem;
        }

        .input-group-icon .input-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            font-size: 1.1rem;
            z-index: 10;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 3rem;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn-primary-custom {
            background: var(--primary-blue);
            border: none;
            color: white;
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary-custom:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-1px);
            color: white;
        }

        .btn-secondary-custom {
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            color: var(--gray-700);
            padding: 0.875rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-secondary-custom:hover {
            background: var(--gray-200);
            border-color: var(--gray-300);
            color: var(--gray-800);
            transform: translateY(-1px);
        }

        .feature-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .feature-card {
            background: white;
            border: 1px solid var(--gray-100);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s ease;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            border-color: var(--gray-200);
        }

        .feature-card .icon {
            width: 48px;
            height: 48px;
            background: var(--success-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: var(--success-green);
            font-size: 1.25rem;
        }

        .feature-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .feature-card p {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin: 0;
        }

        .character-counter {
            text-align: right;
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-top: 0.5rem;
        }

        .character-counter.warning {
            color: var(--warning-amber);
        }

        .character-counter.danger {
            color: var(--red-500);
        }

        .loading-state {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tips-container {
            display: grid;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .tip-item {
            display: flex;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--primary-blue-light);
            border-radius: 12px;
            border: 1px solid var(--primary-blue);
            transition: all 0.2s ease;
        }

        .tip-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .tip-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-blue);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .tip-content h5 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .tip-content p {
            font-size: 0.95rem;
            color: var(--gray-600);
            margin: 0;
            line-height: 1.5;
        }

        .flash-messages {
            margin-bottom: 2rem;
        }

        .alert {
            border-radius: 8px;
            border: none;
            padding: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .alert i {
            font-size: 1.25rem;
        }

        .alert-success {
            background: var(--success-light);
            color: #065F46;
            border-left: 4px solid var(--success-green);
        }

        .alert-danger {
            background: var(--red-light);
            color: #991B1B;
            border-left: 4px solid var(--red-500);
        }

        .alert-info {
            background: var(--primary-blue-light);
            color: #1E3A8A;
            border-left: 4px solid var(--primary-blue);
        }

        .sample-preview {
            background: white;
            border: 1px solid var(--gray-100);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .sample-preview h4 {
            color: var(--gray-900);
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .sample-preview .preview-icon {
            width: 32px;
            height: 32px;
            background: var(--purple-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--purple-500);
            font-size: 0.875rem;
        }

        .sample-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--gray-600);
            font-style: italic;
            border-left: 3px solid var(--purple-500);
            padding-left: 1rem;
            margin: 1rem 0;
        }

        .collapsible-section {
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .collapsible-header {
            background: var(--gray-50);
            padding: 1rem 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .collapsible-header:hover {
            background: var(--gray-100);
        }

        .collapsible-header h5 {
            margin: 0;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .collapsible-header .toggle-icon {
            transition: transform 0.2s ease;
            color: var(--gray-500);
        }

        .collapsible-header.active .toggle-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            padding: 1.5rem;
            display: none;
        }

        .collapsible-content.active {
            display: block;
        }

        .quick-start-tips {
            background: var(--warning-light);
            border: 1px solid var(--warning-amber);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .quick-start-tips h4 {
            color: #92400E;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quick-start-tips .tip-icon {
            color: var(--warning-amber);
            font-size: 1.25rem;
        }

        .quick-start-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .quick-start-list li {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            color: #78350F;
        }

        .quick-start-list li .step-number {
            background: var(--warning-amber);
            color: #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .premium-features {
            background: var(--purple-light);
            border: 1px solid var(--purple-500);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: center;
        }

        .premium-features h4 {
            color: #581C87;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .premium-features .crown-icon {
            color: var(--warning-amber);
            font-size: 1.5rem;
        }

        .premium-features p {
            color: #6B21A8;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .premium-feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .premium-feature-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #6B21A8;
        }

        .premium-feature-item i {
            color: var(--success-green);
            font-size: 1rem;
        }

        .upgrade-btn {
            background: var(--purple-500);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upgrade-btn:hover {
            background: #7C3AED;
            transform: translateY(-1px);
            color: white;
        }

        .form-progress {
            background: var(--gray-100);
            height: 4px;
            border-radius: 2px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .form-progress-bar {
            height: 100%;
            background: var(--primary-blue);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
            .main-content {
                margin-left: 240px;
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            
            .page-title {
                font-size: 1.75rem;
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
            }
            
            .form-container {
                padding: 1.5rem;
            }
            
            .action-buttons {
                flex-direction: column-reverse;
            }
            
            .btn-primary-custom,
            .btn-secondary-custom {
                justify-content: center;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .feature-cards {
                grid-template-columns: 1fr;
            }
            
            .form-container {
                padding: 1.25rem;
            }
            
            .page-header {
                padding: 1.25rem;
            }
        }

        /* Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 200;
            background: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 1.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="bi bi-list"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="{{ url_for('static', filename='uploads/profile_pics/' ~ current_user.profile_pic) }}" alt="Profile Picture">
            <h4>{{ current_user.name or current_user.email }}</h4>
            <div class="user-role">{{ current_user.subscription or 'Free' }} Plan</div>
        </div>
        <nav class="nav flex-column">
            <a class="nav-link" href="{{ url_for('dashboard') }}">
                <i class="bi bi-house"></i> Dashboard
            </a>
            <a class="nav-link" href="{{ url_for('resumes') }}">
                <i class="bi bi-file-earmark-person"></i> Resumes
            </a>
            <a class="nav-link active" href="{{ url_for('cover_letters') }}">
                <i class="bi bi-envelope-paper"></i> Cover Letters
            </a>
            <a class="nav-link" href="{{ url_for('interview_qa') }}">
                <i class="bi bi-question-circle"></i> Interview Q&A
            </a>
            <a class="nav-link" href="{{ url_for('jobs') }}">
                <i class="bi bi-briefcase"></i> Jobs
            </a>
            <a class="nav-link" href="{{ url_for('my_account') }}">
                <i class="bi bi-person"></i> My Account
            </a>
            <a class="nav-link" 
               href="{{ url_for('pricing') }}" 
               title="View and manage subscription plans"
               aria-label="View and manage subscription plans">
                <i class="bi bi-credit-card"></i> Subscription
            </a>
            <a class="nav-link text-danger" href="{{ url_for('logout') }}">
                <i class="bi bi-box-arrow-right"></i> Logout
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages fade-in-up">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'success' if category == 'success' else 'danger' if category == 'error' else 'info' }} alert-dismissible fade show" role="alert">
                            <i class="bi bi-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' if category == 'error' else 'info-circle' }}"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}


        <!-- Feature Cards -->
        <div class="feature-cards fade-in-up" style="animation-delay: 0.2s;">
            <div class="feature-card">
                <div class="icon">
                    <i class="bi bi-robot"></i>
                </div>
                <h4>AI-Powered Content</h4>
                <p>Our advanced AI creates personalized cover letters tailored to your job application</p>
            </div>
            <div class="feature-card">
                <div class="icon">
                    <i class="bi bi-lightning"></i>
                </div>
                <h4>Instant Generation</h4>
                <p>Get a professional cover letter in seconds, not hours of writing and editing</p>
            </div>
            <div class="feature-card">
                <div class="icon">
                    <i class="bi bi-check-circle"></i>
                </div>
                <h4>Industry Standards</h4>
                <p>Follows professional formatting and includes all essential cover letter elements</p>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container fade-in-up" style="animation-delay: 0.4s;">
            


            <form method="POST" id="coverLetterForm">
                <!-- Progress Indicator -->
                <div class="form-progress">
                    <div class="form-progress-bar" id="progressBar"></div>
                </div>

                <!-- Job Information Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="bi bi-briefcase"></i>
                        Job Information
                        <span class="completion-badge" id="jobInfoBadge" style="display: none;">
                            <i class="bi bi-check-circle"></i>
                        </span>
                    </h3>
                    
                    <div class="mb-4">
                        <label for="job_title" class="form-label">
                            Job Title <span class="required">*</span>
                        </label>
                        <div class="input-group-icon">
                            <div class="input-icon">
                                <i class="bi bi-briefcase"></i>
                            </div>
                            <input 
                                type="text" 
                                class="form-control" 
                                name="job_title" 
                                id="job_title" 
                                placeholder="e.g., Software Engineer, Marketing Manager, Data Analyst"
                                required
                                value="{{ session.get('prefill_job_title', '') }}"
                            >
                        </div>
                        <div class="form-help">
                            <i class="bi bi-info-circle"></i>
                            Enter the exact job title from the job posting for best results
                        </div>
                    </div>
                </div>

                <!-- Job Description Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="bi bi-file-text"></i>
                        Job Description (Optional)
                        <span class="completion-badge" id="descriptionBadge" style="display: none;">
                            <i class="bi bi-check-circle"></i>
                        </span>
                    </h3>
                    
                    <div class="mb-4">
                        <label for="description" class="form-label">
                            Job Description or Key Requirements
                        </label>
                        <textarea 
                            class="form-control" 
                            name="description" 
                            id="description" 
                            rows="8" 
                            placeholder="Paste the job description here or list key requirements and qualifications. This helps our AI create a more targeted cover letter that addresses specific needs mentioned in the posting.

Example:
• 3+ years of Python development experience
• Strong background in machine learning
• Experience with cloud platforms (AWS, Azure)
• Excellent communication skills
• Bachelor's degree in Computer Science"
                            maxlength="2000"
                            oninput="updateCharacterCount()"
                        ></textarea>
                        <div class="character-counter" id="charCounter">0 / 2000 characters</div>
                        <div class="form-help">
                            <i class="bi bi-lightbulb"></i>
                            Adding job details helps create a more personalized and relevant cover letter
                        </div>
                    </div>
                </div>

                <!-- Tips Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="bi bi-lightbulb"></i>
                        Pro Tips for Better Cover Letters
                    </h3>
                    
                    <div class="tips-container">
                        <div class="tip-item">
                            <div class="tip-icon">
                                <i class="bi bi-target"></i>
                            </div>
                            <div class="tip-content">
                                <h5>Be Specific</h5>
                                <p>Mention specific skills, experiences, or achievements that match the job requirements</p>
                            </div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-icon">
                                <i class="bi bi-person-heart"></i>
                            </div>
                            <div class="tip-content">
                                <h5>Show Enthusiasm</h5>
                                <p>Express genuine interest in the company and role, not just any job</p>
                            </div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-icon">
                                <i class="bi bi-graph-up"></i>
                            </div>
                            <div class="tip-content">
                                <h5>Quantify Achievements</h5>
                                <p>Include numbers, percentages, or metrics to demonstrate your impact</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <a href="{{ url_for('cover_letters') }}" class="btn-secondary-custom">
                        <i class="bi bi-arrow-left"></i>
                        Back to Cover Letters
                    </a>
                    <button type="submit" class="btn-primary-custom" id="generateBtn">
                        <i class="bi bi-magic"></i>
                        Generate Cover Letter
                    </button>
                </div>
            </form>

            <!-- Loading State -->
            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <h4>Creating Your Cover Letter</h4>
                <p>Our AI is crafting a personalized cover letter based on your information...</p>
            </div>
        </div>

        <!-- Sample Preview Section -->
        <div class="sample-preview fade-in-up" style="animation-delay: 0.6s;">
            <h4>
                <div class="preview-icon">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                Cover Letter Preview
            </h4>
            <p class="sample-text">
                Dear [Hiring Manager's Name],<br>
                <br>
                I am writing to express my interest in the [Job Title] position at [Company Name] as advertised on [Where You Found the Job]. With my background in [Your Field/Industry] and proven skills in [Key Skills or Experiences Relevant to the Job], I am confident in my ability to contribute effectively to your team and help drive the success of [Company Name].<br>
                <br>
                In my previous role at [Your Last Company], I successfully [Achievement or Responsibility that Relates to the Job], which resulted in [Quantifiable Outcome or Recognition]. This experience honed my abilities in [Skill or Area of Expertise], making me a perfect fit for the [Job Title] position.<br>
                <br>
                I am particularly drawn to this role at [Company Name] because [Specific Reason Related to the Company or Position]. I admire [Something Notable About the Company or Its Goals], and I am eager to bring my expertise in [Your Expertise] to your esteemed company.<br>
                <br>
                Thank you for considering my application. I look forward to the opportunity to discuss how my background, skills, and enthusiasms align with the needs of your team. I am excited about the possibility of contributing to the innovative work at [Company Name] and am available at your earliest convenience for an interview.<br>
                <br>
                Sincerely,<br>
                [Your Name]
            </p>
        </div>




    </div>

    <script>
        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const toggle = document.querySelector('.mobile-menu-toggle');
            
            if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
                sidebar.classList.remove('mobile-open');
            }
        });

        // Character counter
        function updateCharacterCount() {
            const textarea = document.getElementById('description');
            const counter = document.getElementById('charCounter');
            const current = textarea.value.length;
            const max = 2000;
            
            counter.textContent = `${current} / ${max} characters`;
            
            // Update styling based on character count
            counter.className = 'character-counter';
            if (current > max * 0.8) {
                counter.classList.add('warning');
            }
            if (current > max * 0.95) {
                counter.classList.remove('warning');
                counter.classList.add('danger');
            }
        }

        // Collapsible section toggle
        function toggleCollapsible(header) {
            const content = header.nextElementSibling;
            const isActive = content.classList.contains('active');
            
            if (isActive) {
                content.classList.remove('active');
                header.classList.remove('active');
            } else {
                content.classList.add('active');
                header.classList.add('active');
            }
        }

        // Form validation
        function validateForm() {
            const jobTitle = document.getElementById('job_title').value.trim();
            
            if (!jobTitle) {
                alert('Please enter a job title before generating your cover letter.');
                return false;
            }
            
            if (jobTitle.length < 2) {
                alert('Please enter a valid job title (at least 2 characters).');
                return false;
            }
            
            return true;
        }

        // Update form progress
        function updateProgress() {
            const jobTitle = document.getElementById('job_title').value.trim();
            const description = document.getElementById('description').value.trim();
            const progressBar = document.getElementById('progressBar');
            const jobInfoBadge = document.getElementById('jobInfoBadge');
            const descriptionBadge = document.getElementById('descriptionBadge');
            
            let progress = 0;
            
            // Job title filled (50% weight)
            if (jobTitle.length >= 2) {
                progress += 50;
            }
            
            // Description filled (50% weight)
            if (description.length > 10) {
                progress += 50;
            }
            
            progressBar.style.width = progress + '%';
            
            // Show completion badges if sections are filled
            jobInfoBadge.style.display = jobTitle.length >= 2 ? 'inline-block' : 'none';
            descriptionBadge.style.display = description.length > 10 ? 'inline-block' : 'none';
        }

        // Add event listeners for progress tracking
        document.addEventListener('DOMContentLoaded', function() {
            const jobTitleInput = document.getElementById('job_title');
            const descriptionInput = document.getElementById('description');
            
            if (jobTitleInput) {
                jobTitleInput.addEventListener('input', updateProgress);
                if (!jobTitleInput.value) {
                    jobTitleInput.focus();
                }
            }
            
            if (descriptionInput) {
                descriptionInput.addEventListener('input', function() {
                    updateCharacterCount();
                    updateProgress();
                });
            }
            
            // Initialize progress and character counter
            updateProgress();
            updateCharacterCount();
        });

        // Enhanced form submission with validation
        document.getElementById('coverLetterForm').addEventListener('submit', function(e) {
            // Validate form first
            if (!validateForm()) {
                e.preventDefault();
                return;
            }
            
            const form = this;
            const loadingState = document.getElementById('loadingState');
            const generateBtn = document.getElementById('generateBtn');
            const progressBar = document.getElementById('progressBar');
            
            // Show loading state
            form.style.display = 'none';
            loadingState.style.display = 'block';
            
            // Simulate progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                
                if (progress === 100) {
                    clearInterval(interval);
                }
            }, 300);
            
            // If there's an error, show the form again
            setTimeout(function() {
                if (window.location.href.includes('create-cover-letter')) {
                    form.style.display = 'block';
                    loadingState.style.display = 'none';
                }
            }, 30000); // 30 second timeout
        });

        // Auto-focus on job title input
        document.addEventListener('DOMContentLoaded', function() {
            const jobTitleInput = document.getElementById('job_title');
            if (jobTitleInput && !jobTitleInput.value) {
                jobTitleInput.focus();
            }
            
            // Initialize character counter
            updateCharacterCount();
        });

        // Clear prefilled job title after using it
        {% if session.get('prefill_job_title') %}
        fetch('{{ url_for("clear_prefill_job_title") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        {% endif %}

        // Subscription button functionality
        function openCustomerPortal() {
            console.log('Subscription button clicked');
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/create-customer-portal';
            form.style.display = 'none';
            document.body.appendChild(form);
            form.submit();
        }
        // Make function globally accessible
        window.openCustomerPortal = openCustomerPortal;
    </script>
    
    <!-- Bootstrap JS for dismissible alerts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
