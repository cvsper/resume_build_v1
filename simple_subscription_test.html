<!DOCTYPE html>
<html>
<head>
    <title>Simple Subscription Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>ðŸ”§ Simple Subscription Route Test</h1>
        
        <div class="alert alert-warning">
            <strong>Note:</strong> You need to be logged in for this to work. If you're not logged in, it will redirect to the login page.
        </div>
        
        <div class="card">
            <div class="card-body">
                <h5>Test 1: Direct Form Submission (No JavaScript)</h5>
                <p>This will submit directly to the backend route without JavaScript.</p>
                <form method="POST" action="/create-customer-portal">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-credit-card"></i> Test Direct Submission
                    </button>
                </form>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body">
                <h5>Test 2: JavaScript Method (Current Implementation)</h5>
                <p>This uses the same JavaScript function as your dashboard.</p>
                <button type="button" class="btn btn-success" onclick="openCustomerPortal()">
                    <i class="bi bi-credit-card"></i> Test JavaScript Method
                </button>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body">
                <h5>Debug Information</h5>
                <div id="debug-info">
                    <p><strong>Current URL:</strong> <span id="current-url"></span></p>
                    <p><strong>Login Status:</strong> Check if you see a login page when clicking buttons</p>
                    <p><strong>Console:</strong> Open browser console (F12) to see debug messages</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Set current URL
        document.getElementById('current-url').textContent = window.location.href;
        
        // Exact same function as dashboard
        function openCustomerPortal() {
            console.log('openCustomerPortal() called');
            
            if (confirm('You will be redirected to Stripe Customer Portal where you can manage your subscription, update payment methods, and view billing history. Continue?')) {
                console.log('User confirmed, creating form...');
                
                // Show loading state
                const button = document.querySelector('button[onclick*="openCustomerPortal"]');
                const originalText = button?.innerHTML;
                if (button) {
                    button.innerHTML = '<i class="bi bi-hourglass-split"></i> Loading...';
                    button.style.pointerEvents = 'none';
                }
                
                try {
                    // Create form to open customer portal
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/create-customer-portal';
                    
                    console.log('Form created, submitting...');
                    console.log('Form action:', form.action);
                    console.log('Form method:', form.method);
                    
                    document.body.appendChild(form);
                    form.submit();
                    
                } catch (error) {
                    console.error('Error creating form:', error);
                    if (button && originalText) {
                        button.innerHTML = originalText;
                        button.style.pointerEvents = 'auto';
                    }
                    alert('Error opening subscription portal. Please try again.');
                }
            } else {
                console.log('User cancelled');
            }
        }
        
        console.log('Test page loaded');
    </script>
</body>
</html>
